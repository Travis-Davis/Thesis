atom_style  peri
units       si

###############################################
# Size, contact parameters
###############################################

#Elastic-Plastic Parameters: K G s00 alpha YieldStress
variable    K equal 1000 #Bulk Modulus
variable    G equal 1000 #Shear Modulus
variable    hor equal 100 #Horizon
variable    s00 equal 2000 #Bond Constant
variable    alpha equal 1e6 #Bond Constant
variable    Yield equal 1e6 #Yield Stress

#Lattice:
variable    diam equal 4
variable    rad equal ${diam}*0.5
variable    rad equal 4*0.5
variable    vol equal 4/3*PI*${rad}^3
variable    vol equal 4/3*PI*2^3

variable    kn equal 1e6
variable    damp equal 0.0
variable    coeffFric equal .3
variable    kt equal 0.5*${kn}
variable    kt equal 0.5*1000000
variable    dens equal 900
variable    minmass equal PI*${rad}^3*${dens}*4/3
variable    minmass equal PI*2^3*${dens}*4/3
variable    minmass equal PI*2^3*900*4/3
variable    gravity equal 9.810

variable    omega equal 0.5*10^(-3)
variable    lambda equal 8.0*10^5

variable    waterDensity equal 1017.0

###############################################
# Geometry-related parameters
###############################################

variable    lx equal  50
variable    ly equal  ${lx}
variable    ly equal  50
variable    lz equal  ${lx}
variable    lz equal  50

###############################################
# Create box
###############################################

boundary    f f f
atom_modify	map array

variable    x0 equal -${lx}
variable    x0 equal -50
variable    x1 equal ${lx}
variable    x1 equal 50
variable    x2 equal -${lx}/4
variable    x2 equal -50/4
variable    x3 equal ${lx}/4
variable    x3 equal 50/4
variable    y0 equal -${ly}
variable    y0 equal -50
variable    y1 equal ${ly}
variable    y1 equal 50
variable    y2 equal -${ly}/4
variable    y2 equal -50/4
variable    y3 equal ${ly}/4
variable    y3 equal 50/4
variable    z0 equal -${lz}
variable    z0 equal -50
variable    z1 equal ${lz}
variable    z1 equal 50
variable    z2 equal -${diam}/4
variable    z2 equal -4/4
variable    z3 equal ${diam}/4
variable    z3 equal 4/4

region      boxreg block ${x0} ${x1} ${y0} ${y1} ${z0} ${z1} units box
region      boxreg block -50 ${x1} ${y0} ${y1} ${z0} ${z1} units box
region      boxreg block -50 50 ${y0} ${y1} ${z0} ${z1} units box
region      boxreg block -50 50 -50 ${y1} ${z0} ${z1} units box
region      boxreg block -50 50 -50 50 ${z0} ${z1} units box
region      boxreg block -50 50 -50 50 -50 ${z1} units box
region      boxreg block -50 50 -50 50 -50 50 units box
create_box  1 boxreg
Created orthogonal box = (-50 -50 -50) to (50 50 50)
  1 by 1 by 1 MPI processor grid

lattice     diamond ${diam}
lattice     diamond 4
Lattice spacing in x,y,z = 4 4 4
region      element block ${x2} ${x1} ${y2} ${y3} ${z2} ${z3} units box
region      element block -12.5 ${x1} ${y2} ${y3} ${z2} ${z3} units box
region      element block -12.5 50 ${y2} ${y3} ${z2} ${z3} units box
region      element block -12.5 50 -12.5 ${y3} ${z2} ${z3} units box
region      element block -12.5 50 -12.5 12.5 ${z2} ${z3} units box
region      element block -12.5 50 -12.5 12.5 -1 ${z3} units box
region      element block -12.5 50 -12.5 12.5 -1 1 units box

###############################################
# Create atoms
###############################################

#create_atoms  1 single .1 .1 1
create_atoms  1 region element
Created 574 atoms
  Time spent = 0.00346208 secs
set group all volume   ${vol}
set group all volume   33.5103216382911
  574 settings made for volume
set group all density  ${dens}
set group all density  900
  574 settings made for density
set group all mass     ${minmass}
set group all mass     30159.289474462
  574 settings made for mass

###############################################
# Computes and Property/atom variables
###############################################

variable    velocity atom sqrt(vx*vx+vy*vy+vz*vz)
variable    R        atom (3/4*mass/(${dens}*PI))^(1/3)
variable    R        atom (3/4*mass/(900*PI))^(1/3)

###############################################
# Force Calculations
###############################################

variable V1    atom (z<-${rad})*${vol}
variable V1    atom (z<-2)*${vol}
variable V1    atom (z<-2)*33.5103216382911
variable V2    atom (z>=-${rad})*(z<=${rad})*(1/2*${vol}+PI*(z^3/3-${rad}^2*z))
variable V2    atom (z>=-2)*(z<=${rad})*(1/2*${vol}+PI*(z^3/3-${rad}^2*z))
variable V2    atom (z>=-2)*(z<=2)*(1/2*${vol}+PI*(z^3/3-${rad}^2*z))
variable V2    atom (z>=-2)*(z<=2)*(1/2*33.5103216382911+PI*(z^3/3-${rad}^2*z))
variable V2    atom (z>=-2)*(z<=2)*(1/2*33.5103216382911+PI*(z^3/3-2^2*z))
variable Vdisp atom v_V1+v_V2
variable Fb    atom ${waterDensity}*${gravity}*v_Vdisp
variable Fb    atom 1017*${gravity}*v_Vdisp
variable Fb    atom 1017*9.81*v_Vdisp
variable Fg    atom ${gravity}*mass
variable Fg    atom 9.81*mass
variable Fd    atom (z<${rad})*(-vz*0)
variable Fd    atom (z<2)*(-vz*0)
variable Fztot atom v_Fb-v_Fg+v_Fd

###############################################
# Fixes and pair styles
###############################################

comm_style    tiled
timestep      1e-3

pair_style    peri/eps
pair_coeff    * *      ${K} ${G} ${hor} ${s00} ${alpha} ${Yield}
pair_coeff    * *      1000 ${G} ${hor} ${s00} ${alpha} ${Yield}
pair_coeff    * *      1000 1000 ${hor} ${s00} ${alpha} ${Yield}
pair_coeff    * *      1000 1000 100 ${s00} ${alpha} ${Yield}
pair_coeff    * *      1000 1000 100 2000 ${alpha} ${Yield}
pair_coeff    * *      1000 1000 100 2000 1000000 ${Yield}
pair_coeff    * *      1000 1000 100 2000 1000000 1000000

fix           1 all    nve
fix           2 all    addforce 0 0 v_Fztot

###############################################
# Run settings
###############################################

variable      dumpfreq equal 10
variable      logfreq equal 100

variable      skin equal 0.3*${diam}
variable      skin equal 0.3*4
neighbor      ${skin} bin
neighbor      1.2 bin

comm_modify	  vel yes cutoff ${diam}
comm_modify	  vel yes cutoff 4

thermo_style	custom step cpu atoms ke lx
thermo_modify	flush yes lost warn
thermo        ${logfreq}
thermo        100

#dump 1        all custom ${dumpfreq} ../data/DUMP/3D_peri.dump id type volume               mass x y z v_velocity

dump 2        all custom ${dumpfreq} ../data/DUMP/3D_peri.dump id type x y z v_R
dump 2        all custom 10 ../data/DUMP/3D_peri.dump id type x y z v_R

run		50000
Neighbor list info ...
  update every 1 steps, delay 10 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 101.2
  ghost atom cutoff = 101.2
  binsize = 50.6, bins = 2 2 2
  2 neighbor lists, perpetual/occasional/extra = 1 1 0
  (1) pair peri/eps, perpetual
      attributes: half, newton on
      pair build: half/bin/atomonly/newton
      stencil: half/bin/3d/newton
      bin: standard
  (2) fix PERI_NEIGH, occasional
      attributes: full, newton on
      pair build: full/bin/atomonly
      stencil: full/bin/3d
      bin: standard
Peridynamic bonds:
  total # of bonds = 328902
  bonds/atom = 573
Per MPI rank memory allocation (min/avg/max) = 187.6 | 187.6 | 187.6 Mbytes
Step CPU Atoms KinEng Lx 
       0            0      574            0          100 
     100     3.936589      574      2363975          100 
     200    7.8662269      574    9133461.5          100 
     300    11.782205      574     19342722          100 
     400    15.700035      574     31431589          100 
     500    19.622162      574     43438995          100 
     600    23.539287      574     53398433          100 
     700    27.481077      574     59855418          100 
     800    31.408921      574     62286767          100 
     900    35.338542      574     61201660          100 
    1000    39.274298      574     57886272          100 
    1100    43.200108      574     53844796          100 
    1200    47.119703      574     49703935          100 
    1300     51.03682      574     45663694          100 
    1400    54.963014      574     41808050          100 
    1500    58.877182      574     38142853          100 
    1600    62.793812      574     34671157          100 
    1700    66.704295      574     31395624          100 
    1800    70.619726      574     28318298          100 
    1900    74.547895      574     25440446          100 
    2000     78.45573      574     22762461          100 
    2100    82.368786      574     20283836          100 
    2200    86.301302      574     18003199          100 
    2300    90.212572      574     15918418          100 
    2400    94.129992      574     14026771          100 
    2500    98.054271      574     12325175          100 
    2600    101.97417      574     10810470          100 
    2700    105.87746      574    9479733.4          100 
    2800    109.87911      574    8330605.2          100 
    2900    113.78439      574    7361580.4          100 
    3000    117.72701      574    6572236.3          100 
    3100    121.63354      574    5963349.1          100 
    3200    125.54792      574    5536873.1          100 
    3300    129.46439      574    5295766.4          100 
    3400     133.3758      574    5243673.1          100 
    3500    137.29326      574    5384493.8          100 
    3600    141.20715      574      5721899          100 
    3700    145.14214      574    6258853.3          100 
    3800    149.11222      574      6997222          100 
    3900    153.16081      574    7937518.7          100 
    4000    157.14284      574    9078836.2          100 
    4100    161.10063      574     10417174          100 
    4200    165.08481      574     11876246          100 
    4300    169.13183      574     13260353          100 
    4400    173.15814      574     14331731          100 
    4500     177.1578      574     14857351          100 
    4600    181.08031      574     14668230          100 
    4700    185.00845      574     13718806          100 
    4800    188.94189      574     12124068          100 
    4900    192.86126      574     10157206          100 
    5000    196.78908      574    8204702.8          100 
    5100    200.76203      574    6691620.9          100 
    5200    204.68112      574    5998578.7          100 
    5300    208.61191      574    6390593.9          100 
    5400    212.52818      574    7970363.4          100 
    5500    216.45544      574     10661014          100 
    5600    220.38815      574     14219385          100 
    5700    224.49374      574     18279054          100 
    5800    229.17394      574     22418749          100 
    5900    233.57148      574     26244585          100 
    6000    238.06303      574     29466673          100 
    6100    242.54741      574     31948298          100 
    6200    246.78033      574     33713474          100 
    6300     250.7253      574     34914037          100 
    6400    254.80441      574     35772235          100 
    6500    258.77586      574     36521088          100 
    6600    262.84095      574     37358085          100 
    6700    266.91023      574     38370900          100 
    6800     271.0621      574     39563138          100 
    6900    275.22011      574     40935788          100 
    7000    279.30419      574     42491017          100 
    7100    283.41009      574     44231954          100 
    7200    287.34374      574     46162322          100 
    7300    291.26529      574     48207503          100 
    7400    295.25117      574     49450711          100 
    7500    299.33493      574     48592145          100 
    7600    303.28386      574     44797298          100 
    7700    307.32269      574     38026609          100 
    7800    311.46169      574     29103531          100 
    7900    315.40454      574     19458796          100 
    8000    319.34688      574     10693446          100 
    8100    323.52011      574      4186165          100 
    8200    327.63643      574    880330.14          100 
    8300    331.70312      574    1235563.4          100 
    8400    335.81707      574    5244047.5          100 
    8500    339.89599      574     12430434          100 
    8600    343.95487      574     21836369          100 
    8700    348.00967      574     32072117          100 
    8800    352.06423      574     41534221          100 
    8900    356.21217      574     48801420          100 
    9000    360.34155      574     53070053          100 
    9100    364.51189      574     54403217          100 
    9200    368.59381      574     53654969          100 
    9300    372.73603      574     52135077          100 
    9400    376.82446      574     50741480          100 
    9500    380.86358      574     49476773          100 
    9600    384.78674      574     48151232          100 
    9700    388.73915      574     46530719          100 
    9800    392.66144      574     44383067          100 
    9900    396.58395      574     41536816          100 
   10000     400.6134      574     37940826          100 
   10100     404.8328      574     33702487          100 
   10200    408.92045      574     29086969          100 
   10300    412.98949      574     24473923          100 
   10400    417.07744      574     20283912          100 
   10500    421.15393      574     16895888          100 
   10600    425.22302      574     14575968          100 
   10700    429.30071      574     13430270          100 
   10800    433.37514      574     13386958          100 
   10900     437.5355      574     14208609          100 
   11000    441.62321      574     15534185          100 
   11100    445.71828      574     16946463          100 
   11200    449.81896      574     18053664          100 
   11300    453.90827      574     18566072          100 
   11400    458.00602      574     18345853          100 
   11500    462.11164      574     17415534          100 
   11600    466.04526      574     15925866          100 
   11700    470.06291      574     14098691          100 
   11800    473.99111      574     12167054          100 
   11900    477.99424      574     10328771          100 
   12000    482.09286      574    8672990.1          100 
   12100     486.1463      574    7200870.6          100 
   12200    490.21244      574    5909980.1          100 
   12300    494.23725      574    4799010.2          100 
   12400    498.24014      574    3867865.9          100 
   12500    502.24919      574    3117606.7          100 
   12600    506.28414      574    2550263.4          100 
   12700    510.40367      574    2168568.2          100 
   12800    514.60079      574      1975638          100 
   12900    518.61388      574    1974649.8          100 
   13000    522.74251      574    2168539.6          100 
   13100    526.80841      574    2559745.8          100 
   13200    530.73654      574    3150011.2          100 
   13300    534.72328      574    3940248.8          100 
   13400    538.74221      574    4930473.6          100 
   13500    542.74908      574      6119801          100 
   13600    546.81045      574      7506511          100 
   13700     550.9509      574    9088179.2          100 
   13800    555.14781      574     10861871          100 
   13900    559.18673      574     12824397          100 
   14000    563.10492      574     14972610          100 
   14100      567.037      574     17303732          100 
   14200    570.96269      574     19815672          100 
   14300     575.0938      574     22507300          100 
   14400    579.13406      574     25378635          100 
   14500    583.12705      574     28430914          100 
   14600    587.05147      574     31666509          100 
   14700    590.96812      574     35087878          100 
   14800    594.89883      574     38637946          100 
   14900    598.83749      574     42135782          100 
   15000    602.75256      574     45352716          100 
   15100    606.68607      574     48058673          100 
   15200     610.6069      574     50079791          100 
   15300    614.52836      574     51358346          100 
   15400    618.46946      574     51992809          100 
   15500    622.39187      574     52237812          100 
   15600    626.32253      574     52056739          100 
   15700    630.24974      574     50586180          100 
   15800    634.17654      574     47092668          100 
   15900    638.13096      574     41390615          100 
   16000    642.06072      574     34008232          100 
   16100    646.00281      574     26064832          100 
   16200    649.92408      574     18905809          100 
   16300    653.87338      574     13702925          100 
   16400     657.8146      574     11212345          100 
   16500     661.7425      574     11736355          100 
   16600    665.66694      574     15198758          100 
   16700    669.60038      574     21210412          100 
   16800    673.53062      574     29066335          100 
   16900    677.45749      574     37720851          100 
   17000    681.40378      574     45858085          100 
   17100    685.38722      574     52147427          100 
   17200    689.42063      574     55638099          100 
   17300    693.58013      574     56055240          100 
   17400    697.68841      574     53896018          100 
   17500    701.65273      574     50293605          100 
   17600    705.59455      574     46511573          100 
   17700    709.58941      574     42916933          100 
   17800    713.51446      574     39507547          100 
   17900    717.44988      574     36280696          100 
   18000    721.39404      574     33234392          100 
   18100    725.32112      574     30367647          100 
   18200    729.24535      574     27680642          100 
   18300    733.18429      574     25174783          100 
   18400    737.10578      574     22852593          100 
   18500    741.03584      574     20717461          100 
   18600    744.96187      574     18773253          100 
   18700    748.89017      574     17023842          100 
   18800    753.02684      574     15472613          100 
   18900     756.9635      574     14122016          100 
   19000    760.93786      574     12973239          100 
   19100    764.87349      574     12026045          100 
   19200     768.8184      574     11278809          100 
   19300    772.73282      574     10728732          100 
   19400    776.66875      574     10372223          100 
   19500    780.59401      574     10205363          100 
   19600    784.52102      574     10224399          100 
   19700     788.4537      574     10426198          100 
   19800    792.37483      574     10808589          100 
   19900    796.33227      574     11370566          100 
   20000    800.33279      574     12111876          100 
   20100    804.26677      574     12979714          100 
   20200    808.20369      574     13796359          100 
   20300     812.1464      574     14334234          100 
   20400    816.07197      574     14362854          100 
   20500    820.00305      574     13705721          100 
   20600    823.93185      574     12300492          100 
   20700    827.85326      574     10240360          100 
   20800    831.78318      574    7777970.6          100 
   20900    835.71675      574    5286365.7          100 
   21000    839.65247      574    3187600.3          100 
   21100    843.57188      574    1869842.5          100 
   21200    847.49458      574    1613847.5          100 
   21300    851.41353      574    2542600.7          100 
   21400    855.33419      574    4600061.8          100 
   21500    859.27495      574    7560417.6          100 
   21600    863.19927      574     11067325          100 
   21700    867.12056      574     14699514          100 
   21800    871.05089      574     18052404          100 
   21900     874.9936      574     20817202          100 
   22000    878.94092      574     22835405          100 
   22100    882.87324      574     24112725          100 
   22200    886.79823      574     24791102          100 
   22300    890.72357      574     25092982          100 
   22400    894.64646      574     25259941          100 
   22500    898.58012      574     25504091          100 
   22600    902.49603      574     25938472          100 
   22700    906.43225      574     26573491          100 
   22800    910.37429      574     27410178          100 
   22900    914.29315      574     28448135          100 
   23000    918.20843      574     29685596          100 
   23100    922.13499      574     31119672          100 
   23200    926.05445      574     32746737          100 
   23300    929.98858      574     34562906          100 
   23400    933.91349      574     36564524          100 
   23500    937.83187      574     38748595          100 
   23600    941.76509      574     41113091          100 
   23700    945.69503      574     43657151          100 
   23800    949.62634      574     46292288          100 
   23900    953.53743      574     48074664          100 
   24000     957.4707      574     47710834          100 
   24100    961.39173      574     44385211          100 
   24200    965.30794      574     38084047          100 
   24300    969.24314      574     29654703          100 
   24400     973.1706      574     20542499          100 
   24500    977.08878      574     12351923          100 
   24600    981.00833      574      6457133          100 
   24700    984.92335      574    3793413.1          100 
   24800    988.86564      574    4811113.4          100 
   24900    992.78561      574    9491818.4          100 
   25000    996.70227      574     17347285          100 
   25100       1000.8      574     27404589          100 
   25200    1004.8892      574     38261345          100 
