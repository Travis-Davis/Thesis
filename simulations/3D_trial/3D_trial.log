#atom_style  sphere
atom_style  peri
units       si

###############################################
# Size, contact parameters
###############################################

variable    diam equal 4
variable    rad equal ${diam}*0.5
variable    rad equal 4*0.5

variable    kn equal 1e6
variable    damp equal 0.0
variable    coeffFric equal .3
variable    kt equal 0.5*${kn}
variable    kt equal 0.5*1000000
variable    dens equal 900
variable    minmass equal PI*${rad}^3*${dens}*4/3
variable    minmass equal PI*2^3*${dens}*4/3
variable    minmass equal PI*2^3*900*4/3
variable    gravity equal 9.810

variable    omega equal 0.5*10^(-3)
variable    lambda equal 8.0*10^5

variable    waterDensity equal 1017.0

###############################################
# Geometry-related parameters
###############################################

variable    lx equal  200
variable    ly equal  ${lx}
variable    ly equal  200
variable    lz equal  ${lx}
variable    lz equal  200

###############################################
# Create box
###############################################
boundary    f f f

variable    x0 equal -${lx}
variable    x0 equal -200
variable    x1 equal ${lx}
variable    x1 equal 200
variable    x2 equal -${lx}/4
variable    x2 equal -200/4
variable    x3 equal ${lx}/4
variable    x3 equal 200/4
variable    y0 equal -${ly}
variable    y0 equal -200
variable    y1 equal ${ly}
variable    y1 equal 200
variable    y2 equal -${ly}/4
variable    y2 equal -200/4
variable    y3 equal ${ly}/4
variable    y3 equal 200/4
variable    z0 equal -${lz}
variable    z0 equal -200
variable    z1 equal ${lz}
variable    z1 equal 200
variable    z2 equal -${diam}
variable    z2 equal -4
variable    z3 equal ${diam}
variable    z3 equal 4

region      boxreg block ${x0} ${x1} ${y0} ${y1} ${z0} ${z1} units box
region      boxreg block -200 ${x1} ${y0} ${y1} ${z0} ${z1} units box
region      boxreg block -200 200 ${y0} ${y1} ${z0} ${z1} units box
region      boxreg block -200 200 -200 ${y1} ${z0} ${z1} units box
region      boxreg block -200 200 -200 200 ${z0} ${z1} units box
region      boxreg block -200 200 -200 200 -200 ${z1} units box
region      boxreg block -200 200 -200 200 -200 200 units box
create_box  1 boxreg
Created orthogonal box = (-200 -200 -200) to (200 200 200)
  1 by 1 by 1 MPI processor grid

lattice     diamond ${diam}
lattice     diamond 4
Lattice spacing in x,y,z = 4 4 4
region      element block ${x2} ${x3} ${y2} ${y3} ${z2} ${z3} units box
region      element block -50 ${x3} ${y2} ${y3} ${z2} ${z3} units box
region      element block -50 50 ${y2} ${y3} ${z2} ${z3} units box
region      element block -50 50 -50 ${y3} ${z2} ${z3} units box
region      element block -50 50 -50 50 ${z2} ${z3} units box
region      element block -50 50 -50 50 -4 ${z3} units box
region      element block -50 50 -50 50 -4 4 units box

###############################################
# Create atoms
###############################################
variable vol equal 4/3*PI*${rad}^3
variable vol equal 4/3*PI*2^3
#create_atoms  1 single .1 .1 2
create_atoms  1 region element
Created 11503 atoms
  Time spent = 0.156211 secs
#set group all diameter ${diam}
set group all volume ${vol}
set group all volume 33.5103216382911
  11503 settings made for volume
set group all density  ${dens}
set group all density  900
  11503 settings made for density
set group all mass     ${minmass}
set group all mass     30159.289474462
  11503 settings made for mass

###############################################
# Computes and Property/atom variables
###############################################

#compute     rad all property/atom radius
variable    velocity atom sqrt(vx*vx+vy*vy+vz*vz)

###############################################
# Force Calculations
###############################################

variable Vtot  atom 4/3*PI*c_rad^3
variable V1    atom (z<-c_rad)*v_Vtot
variable V2    atom (z>=-c_rad)*(z<=c_rad)*(1/2*v_Vtot+PI*(z^3/3-c_rad^2*z))
variable Vdisp atom v_V1+v_V2
variable Fb    atom ${waterDensity}*${gravity}*v_Vdisp
variable Fb    atom 1017*${gravity}*v_Vdisp
variable Fb    atom 1017*9.81*v_Vdisp
variable Fg    atom ${gravity}*mass
variable Fg    atom 9.81*mass
variable Fd    atom (z<c_rad)*(-vz*10000)
variable Fztot atom v_Fb-v_Fg+v_Fd

###############################################
# Fixes and pair styles
###############################################
comm_style  tiled
variable    tcol equal PI/sqrt(2*${kn}/${minmass}-${damp}^2/4.0)
variable    tcol equal PI/sqrt(2*1000000/${minmass}-${damp}^2/4.0)
variable    tcol equal PI/sqrt(2*1000000/30159.289474462-${damp}^2/4.0)
variable    tcol equal PI/sqrt(2*1000000/30159.289474462-0^2/4.0)
variable    dt equal ${tcol}*0.02
variable    dt equal 0.38578508014883*0.02
#timestep   ${dt}
timestep    1e-2

pair_style      peri/pmb
pair_coeff      * * 1.6863e22 0.0015001 0.0005 0.25
#pair_style	gran/hooke ${kn} ${kt} ${damp} 0 ${coeffFric} 1
#pair_coeff  * *

#fix		1 all  nve/sphere
fix   1 all  nve
#fix   2 all  gravity 9.81 vector 0 0 -1
fix   3 all  addforce 500 0 v_Fztot
#fix		wx all wall/gran hooke ${kn} ${kt} ${damp} 0 ${coeffFric} 1 xplane ${x0} ${x1}
#fix		wy all wall/gran hooke ${kn} ${kt} ${damp} 0 ${coeffFric} 1 yplane ${y0} ${y1}
#fix		wz all wall/gran hooke ${kn} ${kt} ${damp} 0 ${coeffFric} 1 zplane ${z0} ${z1}

###############################################
# Run settings
###############################################

variable      dumpfreq equal 10
variable      logfreq equal 100

variable      skin equal 0.3*${diam}
variable      skin equal 0.3*4
neighbor      ${skin} bin
neighbor      1.2 bin

comm_modify	  vel yes cutoff ${diam}
comm_modify	  vel yes cutoff 4

thermo_style	custom step cpu atoms ke lx
thermo_modify	flush yes lost warn
thermo        ${logfreq}
thermo        100

dump 1        all custom ${dumpfreq} ../data/DUMP/3D_trial.dump id type mass               radius x y z vz fz v_Fb v_Vdisp
dump 1        all custom 10 ../data/DUMP/3D_trial.dump id type mass               radius x y z vz fz v_Fb v_Vdisp
ERROR: Dumping an atom property that isn't allocated (../dump_custom.cpp:1289)
Last command: dump 1        all custom ${dumpfreq} ../data/DUMP/3D_trial.dump id type mass               radius x y z vz fz v_Fb v_Vdisp
